"use strict";(self.webpackChunkrm_frontend=self.webpackChunkrm_frontend||[]).push([[41],{1345:function(t,i,e){var s,o,r,n=e(617);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(t,i,e){return(i=function(t){var i=function(t,i){if("object"!==h(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!==h(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"===h(i)?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function a(t,i){return i||(i=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(i)}}))}i.Z=(p(r={},"template-common-hotspot-widget",(0,n.f)(s||(s=a(['\n\n    <div class="common-hotspot">\n      <div class="pin"></div>\n    </div>\n\n'])))),p(r,"template-common-hotspot-widget-mobile-wrapper",(0,n.f)(o||(o=a(['\n\n    <div class="hotspot-fullscreen-wrapper invisible">\n        <div class="center-table">\n            <div class="center-cell">\n\n            </div>\n        </div>\n    </div>\n\n'])))),r)},1347:function(t,i,e){var s=e(311),o=e(335),r=e.n(o),n=e(320),h=e(1345),p=e(339),a=r().View.extend({TIP_GAP:15,initialize:function(t){t&&(n.Z.bindAll(this),this.block=t.block,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,this.template=h.Z["template-common-hotspot-widget"],this.render())},render:function(){this.setElement((0,s.ZP)(this.template({data:this.model}))),"viewer"===this.environment&&(this.apply_tip_container_size({width:this.model.tip_w,height:this.model.tip_h}),this.apply_tip_position(this.model)),this.$el.appendTo(this.$container)},apply_tip_container_size:function(t){t&&0===t.height&&(t.height=120),t&&this.$(".tip").css(t)},apply_tip_bg_color:function(t){this.$(".blocks-wrapper").css("background-color",p.Z.getRGBA(t["tip_background-color"],t["tip_background-color-opacity"]/100))},apply_tip_border_radius:function(t){this.$(".blocks-wrapper").add(this.$(".tip")).css("border-radius",t["tip_border-radius"]+"px")},apply_tip_box_shadow:function(t){this.$(".tip").toggleClass("box-shadow",!!t["tip_box-shadow"])},apply_tip_position:function(t){var i;if((null===(i=t.flags)||void 0===i?void 0:i.tipFreePosition)||!1){var e=this.$(".tip"),s={};return"sw"===t.fixed_position||"s"===t.fixed_position?(s.bottom=t.tip_y-t.y,s.left=t.tip_x-t.x,s.top="",s.right=""):"se"===t.fixed_position?(s.bottom=t.tip_y-t.y,s.right=t.tip_x-t.x,s.top="",s.left=""):"e"===t.fixed_position||"ne"===t.fixed_position?(s.top=t.tip_y-t.y,s.right=t.tip_x-t.x,s.left="",s.bottom=""):(s.top=t.tip_y-t.y,s.left=t.tip_x-t.x,s.right="",s.bottom=""),e.css(s),s}var o,r=this.$(".tip"),n=t.tip_pos,h=t.tip_w,p=t.tip_h||120,a=t.w,c=t.h,l="",u="",d=this.TIP_GAP;return"top"===n?(l=-(d+p),u=a/2-h/2):"right"===n?(l=c/2-p/2,u=a+d):"bottom"===n?(l=c+d,u=a/2-h/2):"left"===n&&(l=c/2-p/2,u=-(d+h)),o={top:l,left:u},r.css(o),o},destroy:function(){this.remove()}});i.Z=a},1344:function(t,i,e){e.r(i);var s=e(311),o=e(320),r=e(1303),n=e(339),h=e(1345),p=e(1346),a=e(1347),c=e(322),l=e(1342),u=e(1348),d=e(1349),f=e(923);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,s)}return e}function m(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?b(Object(e),!0).forEach((function(i){v(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}function v(t,i,e){return(i=function(t){var i=function(t,i){if("object"!==g(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,i||"default");if("object"!==g(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"===g(i)?i:String(i)}(i))in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}var w=r.Z.extend(p.Z.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){var t,i;if(this.makeBox("widget-hotspot"),this.rendered=!0,this.phoneTipWrapperTemplate=h.Z["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!(!RM.constructorRouter||!RM.constructorRouter.preview),this.useFreePosition=(null===(t=this.flags)||void 0===t?void 0:t.tipFreePosition)||!1,i={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new a.Z(i),this.$pin=this.$(".pin").addClass("viewer"),this.cursorStyle&&this.$pin.css("cursor",this.cursorStyle),this.started&&this.renderTip(),"icon"===this.pin_type){if(this.$el.addClass("icon"),!this.rasterUrl&&!this.b64url)return this.widgetIsLoaded(),this;var e=(0,s.ZP)("<img>");e.on("load",o.Z.bind((function(){this.$(".pin").html(e),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded),e.attr("src",this.raster3xUrl||this.raster2xUrl||this.rasterUrl||this.b64url||"")}else this.renderPinShape(),this.widgetIsLoaded();return this},renderPinShape:function(){var t,i=new Backbone.Model(this);i.id=this._id,t=this.generateShapeSVG("viewer",i,this.w,this.h),this.$pin.html(t)},renderTip:function(){this.isTipRendered||(this.$tip=(0,s.ZP)('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=(0,s.ZP)('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":n.Z.getRGBA(this["tip_background-color"],this["tip_background-color-opacity"]/100),"border-radius":this["tip_border-radius"]}),this.$(".common-hotspot").append(this.$tip),this.pictureData=o.Z.findWhere(this.wids||[],{type:"picture"}),this.textData=o.Z.findWhere(this.wids||[],{type:"text"}),this.hasPictureWidget=!(!this.pictureData||this.pictureData.hidden),this.hasTextWidget=!(!this.textData||this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureData.useFreePosition=this.useFreePosition,this.pictureWidget=new l.default(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textData.useFreePosition=this.useFreePosition,this.textData.hasGlobalParent=this.is_global,3===this.textData.version?this.textWidget=new d.default(m(m({},this.textData),{},{is_above:this.is_above,is_global:this.is_global}),this.page,this.$blocksWrapper):this.textWidget=new u.default(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.textWidget.render()),this.hasPictureWidget||this.hasTextWidget?(this.$closeButton=(0,s.ZP)('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0):this.$tip.remove())},updatePage:function(t){r.Z.prototype.updatePage.apply(this,arguments),this.textWidget&&this.textWidget.updatePage(t)},start:function(){return r.Z.prototype.start.call(this),this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return r.Z.prototype.stop.call(this),this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){if(this.useFreePosition)this.hotspotWidget.apply_tip_position({y:this.y,x:this.x,tip_y:this.tip_y,tip_x:this.tip_x,flags:this.flags,fixed_position:this.fixed_position});else{var t,i,e=this.calcDistsToPageVisibleBounds(),s={w:this.w,h:this.h},r={w:this.$tip.width(),h:this.$tip.height()},n=this.hotspotWidget.TIP_GAP,h=this.tip_pos,p=o.Z.pick(this,"w","h","tip_w","tip_h","tip_pos"),a=!1,c=!1;function l(t){var i,o,h,p;switch(t){case"top":i=e.top-s.h/2-n-r.h,h=e.bottom+s.h/2+n,p=e.left-r.w/2,o=e.right-r.w/2;break;case"right":i=e.top-r.h/2,h=e.bottom-r.h/2,p=e.left+s.w/2+n,o=e.right-s.w/2-n-r.w;break;case"bottom":i=e.bottom+s.h/2+n,h=e.bottom-s.h/2-n-r.h,p=e.left-r.w/2,o=e.right-r.w/2;break;case"left":i=e.top-r.h/2,h=e.bottom-r.h/2,p=e.left-s.w/2-n-r.w,o=e.right+s.w/2+n}return{top:i,left:p,bottom:h,right:o}}function u(t){var i,e=t,s=-1/0,r=!1;return o.Z.each(["top","right","bottom","left"],(function(n){if(!r){var h=l(n);i=o.Z.min(h),n===t&&h[n]>0?(e=n,r=!0):i>s&&h[n]>=0&&(s=i,e=n)}})),e}h=u(this.tip_pos),p.tip_pos=h,i=this.hotspotWidget.apply_tip_position(p),t=l(h),o.Z.each(t,function(t,e){if(t<0)switch(e){case"top":i.top-=t-this.EDGE_GAP,a=!0;break;case"bottom":a||(i.top+=t-this.EDGE_GAP);break;case"left":i.left-=t-this.EDGE_GAP,c=!0;break;case"right":c||(i.left+=t-this.EDGE_GAP)}}.bind(this)),this.$tip.css(i)}},adjustPictureSize:function(){var t,i=this.tip_w/this.PHONE_TIP_WIDTH;this.pictureWidget&&(t=this.isPhone()?{width:this.PHONE_TIP_WIDTH,height:this.pictureData.h/i}:{width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(t))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),RM.analytics&&this.isTipVisible&&RM.analytics.sendEvent("Hotspot Click"))},onMouseenter:function(){this.isHoverable()&&this.isTipRendered&&(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),RM.analytics&&RM.analytics.sendEvent("Hotspot Hover"))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},showTip:function(){if(this.isTipRendered){if(this.adjustPictureSize(),this.isPhone()){this.$phoneTipWrapper=this.$phoneTipWrapper||(0,s.ZP)(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent();var t=this.$phoneTipWrapper.find(".center-cell");this.$tip.detach().appendTo(t);var i=this.mag.getScale(this.page.pageViewport);this.$tip.css({transform:"scale(".concat(i,")")});var e=f.Z.mapElementToViewport(this.$tip[0],i,1);t.css({height:e.height}),o.Z.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(t){(0,s.ZP)(t.target).closest(".tip").is(this.$tip)||(this.hideTip(),this.$phoneTipWrapper.off())}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)}else this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.BringToTopZ(),this.page.mag.$container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||(0,s.ZP)("body").on("keydown",this.onBodyKeyDown);this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.$tip.on("click",".maglink",this.onTipLinkClick),this.isTipVisible=!0}},hideTip:function(){this.isTipVisible&&(this.isTipVisible=!1,clearTimeout(this.mouseLeaveTimeout),this.isPhone()?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),o.Z.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),this.BackToNormalZ(),(0,s.ZP)("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"))},onTipLinkClick:function(t){(0,s.ZP)(t.currentTarget).hasClass("close-tip-on-click")&&this.hideTip()},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();var i=(0,s.ZP)(t.currentTarget),e=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(e<0&&i.scrollTop()<=0||e>0&&i.scrollTop()+i.height()>=i[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(){this.hideTip()},onGlobalMouseDown:function(t){var i=(0,s.ZP)(t.target),e=i.closest(".pin"),o=i.closest(".tip");e.is(this.$pin)||o.is(this.$tip)||(this.page.mag.$container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return c.Z.isPhone||this.isPreview&&"phone_portrait"===this.page.mag.viewport},isHoverable:function(){return"hover"===this.tip_show_on&&c.Z.isDesktop&&!this.isPhone()&&"tablet_portrait"!==this.page.mag.viewport},onBodyKeyDown:function(t){t.keyCode===s.ZP.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,r.Z.prototype.destroy.apply(this,arguments)}});i.default=w}}]);