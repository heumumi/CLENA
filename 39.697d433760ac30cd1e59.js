"use strict";(self.webpackChunkrm_frontend=self.webpackChunkrm_frontend||[]).push([[39],{1341:function(t,e,i){i.d(e,{Z:function(){return C}});var n,o=i(311),a=i(335),r=i.n(a),s=i(320),l=i(339),h=i(617);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}var c,p,d,f,m,g=(c={},p="template-common-form-button",d=(0,h.f)(n||(f=['\n\t<div class="button">\n\t\t<div class="caption"></div>\n\t\t<svg class="error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M17 19.8c-1.4 0-2.6 1.1-2.6 2.6s1.1 2.6 2.6 2.6c1.4 0 2.6-1.1 2.6-2.6S18.4 19.8 17 19.8zM19 0.4h-4L15 17.4h4L19 0.4z"/></svg>\n\t\t<div class="pending"></div>\n\t\t<svg class="show-if-empty-submitted-text" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M31.4 3C30.6 2.3 29.4 2.3 28.6 3l0 0L13.1 18.6l-7.8-7.8 0 0c-0.8-0.7-2-0.7-2.7 0 -0.8 0.8-0.8 2 0 2.7l0 0L13.1 24.1l0.4-0.4h0L31.4 5.8l0 0C32.1 5 32.1 3.8 31.4 3z"/></svg>\n\t</div>\n'],m||(m=f.slice(0)),n=Object.freeze(Object.defineProperties(f,{raw:{value:Object.freeze(m)}})))),(p=function(t){var e=function(t,e){if("object"!==u(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===u(e)?e:String(e)}(p))in c?Object.defineProperty(c,p,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[p]=d,c),b=i(322),v=i(338),y=i(1323);function w(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return I(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw a}}}}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var _=r().View.extend({MIN_FIELD_WIDTH:9,MIN_FIELD_HEIGHT:5,CAPTCHA_WIDTH:304,CAPTCHA_HEIGHT:78,CAPTCHA_INVISIBLE:!0,LINE_HEIGHT_FACTOR:1.2,INVALID_COLOR:"ff4828",INVALID_BORDER_WIDTH:2,DROPDOWN_TRIANGLE:{SVG:'<svg class="form-dropdown-triangle" width="9" height="6" preserveAspectRatio="none" viewBox="0 0 9 6" xmlns="http://www.w3.org/2000/svg"><path d="M3.763 5.196L.536 1.676A1 1 0 0 1 1.273 0h6.454a1 1 0 0 1 .737 1.676l-3.227 3.52a1 1 0 0 1-1.474 0z" fill-rule="evenodd"/></svg>',OPACITY_MULTIPLIER:.4,W:9,H:6,FONT_SIZE:18},CHECKBOX_TICK:{SVG:'<svg width="19" height="14" preserveAspectRatio="none" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><path d="M6.657 10.9L17.263.292a1 1 0 1 1 1.415 1.414L7.364 13.021a.997.997 0 0 1-1.414 0L.293 7.364A1 1 0 1 1 1.707 5.95l4.95 4.95z" fill-rule="evenodd"/></svg>',W:19,H:14,FONT_SIZE:18},initialize:function(t){s.Z.bindAll(this),this.data=t.data,this.$container=t.$container,this.environment=t.environment,this.buttonTemplate=g["template-common-form-button"]},render:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.rendered?e.force&&this.$el&&this.$el.empty():(this.setElement((0,o.ZP)("<div>")),this.$el.addClass("form-wrapper").appendTo(this.$container),"constructor"!==this.environment&&this.$el.on(b.Z.isDesktop?"mouseenter":"touchstart",".button",this.onButtonHover).on(b.Z.isDesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut),this.$el.on("change","select",this.onDropdownChange).on("mouseenter",".input-wrapper",this.onInputHover).on("mouseleave",".input-wrapper",this.onInputHoverOut),this.rendered=!0);var i,n,a=this.data,r=a.fields,s=(0,o.ZP)('<div><form enctype="multipart/form-data" method="post" target="form_submit_iframe"></form></div>'),h=s.find("form"),u=RM.constructorRouter&&RM.constructorRouter.previewMode,c=!!RM.constructorRouter,p=!1;if(RM.screenshot)window.ServerData.userPermissions&&window.ServerData.userPermissions.can_use_forms_file_upload&&(p=!0);else{var d=y.Z.getPermissions();d&&d.can_use_forms_file_upload&&(p=!0)}for(var f=0;f<r.length;f++){var m=r[f];if(("file"!==m.tp||p||c)&&"captcha"!==m.tp){i="vertical"===a.layout&&"text"===m.tp,(n=(0,o.ZP)(i?"<textarea>":"<input>")).addClass("js-input"),n.attr("type","text").attr("autocapitalize","name"===m.tp?"on":"off").attr("autocomplete","off").attr("autocorrect","off").attr("name",m.caption).attr("placeholder",m.caption+(m.optional&&"viewer"!==this.environment?" (optional)":"")).attr("spellcheck",!1).attr("data-sort",m.sort),"email"===m.tp&&n.attr("inputmode","email"),"phone"===m.tp&&n.attr("inputmode","tel"),"number"===m.tp&&n.attr("inputmode","numeric"),"checkbox"===m.tp&&n.attr("type","checkbox"),"dropdown"===m.tp&&(n.attr({tabindex:-1}),n.prop({readonly:!0}),n.addClass("fake-dropdown"));var g=(0,o.ZP)('<div class="input-wrapper js-input-wrapper"/>');if(g.append(n),g.append('<div class="overlay"></div>'),"viewer"!==this.environment&&i){var v=(0,o.ZP)('<span class="input-line-control input-line-control-add js-add-line"></span>'),w=(0,o.ZP)('<span class="input-line-control input-line-control-remove js-remove-line"></span>');g.append(v).append(w)}if("file"===m.tp){"viewer"===this.environment&&n.attr("type","file");var I="formfiles-".concat(this.data._id).concat("viewer"!==this.environment?"-constructor":"");n.attr("name","formfiles"),n.attr("id",I),n.attr("multiple",""),n.attr("accept",(window.ServerData.config.FORMS_ACCEPTED_MIMES||[]).join(",")),n.addClass("input-file");var _=m.caption+(m.optional&&"viewer"!==this.environment?" (optional)":"")||"Add files";g.append((0,o.ZP)("<label ".concat(p?'for="'.concat(I,'"'):"",' class="input-file-label').concat("viewer"!==this.environment?" no-hover":"",'" data-empty-text="').concat(_).concat(u&&!p?" (Business plan only)":"",'"><span class="files-name">').concat(_).concat(u&&!p?" (Business plan only)":"",'</span><span class="files-count"></span></label>'))),"viewer"===this.environment&&g.append((0,o.ZP)('<span class="input-file-control input-file-control-add">&nbsp;</span><span class="input-file-control input-file-control-remove">&nbsp;</span>'))}if(g.appendTo(h),"dropdown"===m.tp&&m.items){var C=(0,o.ZP)("<select>"),S=(0,o.ZP)(this.DROPDOWN_TRIANGLE.SVG);C.attr("name",m.caption),(0,o.ZP)('<option value="" selected></option>').prop("disabled",!m.optional).appendTo(C);for(var x=0;x<m.items.length;x++)(0,o.ZP)("<option>").attr("value",m.items[x]).text(m.items[x]).appendTo(C);n.parent().append(S).append(C)}if("checkbox"===m.tp){var R=b.Z.isDesktop?"":"input-checkbox-wrapper-mobile";n.wrap('<label class="input-checkbox-wrapper '+R+'"></label>'),n.after('\t\t\t\t\t\t<div class="input-checkbox-inner"> \t\t\t\t\t\t\t<span class="label">'+n.attr("placeholder")+'</span> \t\t\t\t\t\t\t<span class="tick">'+this.CHECKBOX_TICK.SVG+"</span> \t\t\t\t\t\t</div>")}}}if((0,o.ZP)(this.buttonTemplate()).appendTo(h),this.$el.html(s.html()).addClass("common-form"),this.data.captcha&&!RM.common.isDownloadedSource){var T=l.Z.generateUUID(),$=(0,o.ZP)('<div id="'.concat(T,'" class="captcha-holder captcha-invisible"></div>'));this.$el.find("form").append($),window.recaptchaReadyPromise&&window.recaptchaReadyPromise.then((function(){t.captcha=window.grecaptcha.render(T,{sitekey:window.ServerData.config.RECAPTCHA_SITEKEY,callback:t.captchaCallback.bind(t),theme:$.data("type")||"light",size:"invisible",isolated:!0})}))}this.$button=this.$(".button"),this.$buttonIcons=this.$(".button svg"),this.data.cursorStyle&&this.$button.css("cursor",this.data.cursorStyle),this.$inputs=this.$(".input-wrapper"),this.$triangles=this.$(".form-dropdown-triangle"),this.$fileInputLabel=this.$inputs.find(".input-file-label"),this.$fileInputLabelText=this.$inputs.find(".input-file-label > .files-name"),this.$fileInputLabelCount=this.$inputs.find(".input-file-label > .files-count"),"viewer"===this.environment&&(this.$fileInput=this.$inputs.find(".input-file"),this.$fileInput&&this.$fileInput.on("change",this.onFileChange),this.$fileAddCtrl=this.$(".input-file-control-add"),this.$fileRemoveCtrl=this.$(".input-file-control-remove"),this.$fileRemoveCtrl&&this.$fileRemoveCtrl.on("click",this.onFileRemove)),this.recalcStyles()},executeCaptcha:function(t){this.hasOwnProperty("captcha")?(this.captchaExecuteCallback=t,window.grecaptcha.reset(this.captcha),window.grecaptcha.execute(this.captcha)):t()},captchaCallback:function(t){var e=this;this.captchaResponse=t,setTimeout((function(){return e.captchaExecuteCallback(t)}),0)},validateFiles:function(t){if(!t||!t.length)return!0;var e=y.Z.getPermissions();if(t.length>e.forms_file_upload_count)return alert(v.ZP.MSG_UPLOAD_FORMS_FILES_ERROR),!1;var i,n=w(t);try{for(n.s();!(i=n.n()).done;){if(i.value.size>e.forms_file_upload_limit)return alert(v.ZP.MSG_UPLOAD_FORMS_SIZE_ERROR),!1}}catch(t){n.e(t)}finally{n.f()}return!0},onFileChange:function(){var t=this.$fileInput.get(0).files;if(!t||!t.length)return this.$fileRemoveCtrl&&this.$fileRemoveCtrl.hide(),this.$fileAddCtrl&&this.$fileAddCtrl.show(),this.$fileInputLabelText.text(this.$fileInputLabel.data("emptyText")),this.$fileInputLabelCount.text(""),void this.$fileInputLabel.removeClass("has-files");if(!this.validateFiles(t))return this.onFileRemove();this.$fileInputLabel.addClass("has-files"),this.$fileRemoveCtrl&&this.$fileRemoveCtrl.show(),this.$fileAddCtrl&&this.$fileAddCtrl.hide();var e=(t[0].name||"Filename").split("\\").join("/").split("/").pop();this.$fileInputLabelText.text(e),this.$fileInputLabelCount.text(t.length>1?" +".concat(t.length-1):"")},onFileRemove:function(){this.$fileInput.val(""),this.onFileChange()},onDropdownChange:function(t){(0,o.ZP)(t.currentTarget).parent().find(".js-input").val((0,o.ZP)(t.currentTarget).val())},setButtonHoverState:function(){this.forcePseudoState="hover",this.applyButtonStyle()},unsetButtonHoverState:function(){this.forcePseudoState=!1,this.applyButtonStyle()},recalcStyles:function(t){this.$el.attr("data-layout",this.data.layout).attr("data-style",this.data.style),this.$button.find(".caption").text(this.data["button-caption"]),this.resizeElements(t),this.applyInputsStyle(this.$inputs),this.applyButtonStyle(t)},getMinimalDimensions:function(){var t,e=this.data,i=e.fields,n=e["style-"+e.style+"-fields"],o=e["style-"+e.style+"-button-default"],a=this.getButtonValue.bind(this,o,n),r=i.find((function(t){return"captcha"===t.tp})),s=o.gutter+(i.length-(r&&this.CAPTCHA_INVISIBLE?1:0))*n.gutter,l=n["underline-width"]||0,h=Math.max(Math.ceil(a("font-size")*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+l,u=Math.max(Math.ceil(n["font-size"]*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+l,c=Math.max(h,u);return"vertical"===e.layout&&(t={width:Math.max(r&&!this.CAPTCHA_INVISIBLE?this.CAPTCHA_WIDTH:0,this.MIN_FIELD_WIDTH),height:s+this.getTotalInputsHeight(i,c)+c}),"horizontal"===e.layout&&(t={width:s+i.length*this.MIN_FIELD_WIDTH+(o.width||0)+(r&&!this.CAPTCHA_INVISIBLE?this.CAPTCHA_WIDTH:this.MIN_FIELD_WIDTH),height:Math.max(c,r&&!this.CAPTCHA_INVISIBLE?this.CAPTCHA_HEIGHT:0)}),t},getTotalInputsHeight:function(t,e){return s.Z.reduce(t,function(t,i){return"text"===i.tp?t+this.getExtraTextareaDimensions(i.rows,e).height:"captcha"===i.tp?t+this.CAPTCHA_INVISIBLE?0:this.CAPTCHA_HEIGHT:t+e}.bind(this),0)},getRowsCount:function(t){return s.Z.reduce(t,(function(t,e){return t+("captcha"===e.tp?0:"text"===e.tp&&e.rows||1)}),0)},getInputDimensionsWithFixedButton:function(t){var e,i,n=this.data,o=n.fields,a=n["style-"+n.style+"-button-default"],r=n["style-"+n.style+"-fields"],s="vertical"===n.layout,l=a.width||0,h=a.width&&!s?o.length:o.length+1,u=o.find((function(t){return"captcha"===t.tp})),c=a.gutter+(o.length+(u?-1:0))*r.gutter,p=t&&void 0!==t.w?t.w:n.w,d=t&&void 0!==t.h?t.h:n.h,f=Math.floor(s?d:p),m=s?this.CAPTCHA_HEIGHT:this.CAPTCHA_WIDTH,g=f-c-(u&&!this.CAPTCHA_INVISIBLE?m+r.gutter:0);if(s){var b=this.getLineHeight(),v=g-this.getRowsCount(o)*b.input-b.input,y=Math.ceil(v/(h-(u?1:0)));e=b.input+y,i=this.getTotalInputsHeight(o,e)+e+c-f}else i=(e=Math.ceil((g-l)/(h-(u?1:0))))*(o.length+1)+c+l-f;return{overflow:i,itemSize:e,buttonSize:a.width&&!s?a.width:e,itemOtherSize:s?p:d,gutter:r.gutter,lastGutter:a.gutter+r.gutter}},getLineHeight:function(){var t=this.data||{},e=this.LINE_HEIGHT_FACTOR,i=this.getButtonValue(t["style-"+t.style+"-button-default"],t["style-"+t.style+"-fields"],"font-size"),n=t["style-"+t.style+"-fields"]["font-size"];return{input:Math.floor(e<10?e*n:e),button:Math.floor(e<10?e*i:e)}},getExtraTextareaDimensions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0,i=this.getLineHeight(),n=Math.round(e-i.input),o=this.data&&"underlined"===this.data.style,a=o?n:Math.ceil(n/2),r=o?0:Math.floor(n/2);return{height:t*i.input+a+r,top:a,bottom:r}},resizeElements:function(t){var e=this.data,i="vertical"===e.layout,n=e.fields,a=n.length,r=this.getInputDimensionsWithFixedButton(t),s=r.overflow,l=e["style-"+e.style+"-fields"],h=(l&&l["underline-width"]||0)+2;this.$inputs.add(this.$button).each(function(t,e){var l={},u=t>=a?r.buttonSize:r.itemSize,c=t===a-1,p=t<a,d=n[t],f=(0,o.ZP)(e),m=t>=a+1-s;if(m&&u--,l[i?"height":"width"]=u+"px",l[i?"width":"height"]=r.itemOtherSize+"px",p&&(l[i?"margin-bottom":"margin-right"]=c?r.lastGutter:r.gutter),l[i?"margin-right":"margin-bottom"]="",i&&d&&"captcha"===d.tp&&delete l.height,!i&&d&&"captcha"===d.tp&&delete l.width,i&&d&&"text"===d.tp){var g=d.rows||1,b=f.find(".js-input"),v=f.find(".js-add-line"),y=f.find(".js-remove-line"),w=this.getExtraTextareaDimensions(g,r.itemSize);l.height=w.height+(m?-1:0)+"px",b.css({top:w.top-h,bottom:w.bottom}),b.attr({rows:g}),v.css({top:w.top-h}),y.css({bottom:w.bottom+h}),f.toggleClass("is-multiline",g>1)}f.css(l)}.bind(this))},showInputPlaceholdersAsValues:function(t){this.$inputs.each((function(e,i){var n=(0,o.ZP)(i).find(".js-input");"checkbox"===n.attr("type")?n.parent().find(".label").addClass("input-checkbox-preview"):n.val(t?n.attr("placeholder"):"")}))},applyInputsStyle:function(t){var e,i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.data,r=s.Z.clone(a["style-"+a.style+"-fields"]);"underlined"===a.style?(n.invalid&&(r["underline-color"]=this.INVALID_COLOR,r["underline-opacity"]=100,r["underline-width"]=r["underline-width"]||this.INVALID_BORDER_WIDTH),e={"background-color":"transparent","border-radius":0,"box-shadow":"inset 0 "+2*-r["underline-width"]+"px 0 "+-r["underline-width"]+"px "+this.getRgba(r["underline-color"],r["underline-opacity"])}):(n.invalid&&(r["border-color"]=this.INVALID_COLOR,r["border-opacity"]=100,r["border-width"]=r["border-width"]||this.INVALID_BORDER_WIDTH),e={"background-color":this.getRgba(r.color,r.opacity),"border-radius":r["border-radius"]+"px","box-shadow":"inset 0 0 0 "+r["border-width"]+"px "+this.getRgba(r["border-color"],r["border-opacity"])});var l={"font-family":r["font-family"],"font-style":r["font-style"],"font-weight":r["font-weight"],color:this.getRgba(r["text-color"],r["text-opacity"]),"font-size":r["font-size"],"letter-spacing":r["letter-spacing"],"margin-bottom":r["underline-width"]?r["underline-width"]+"px":0};t.filter(":not(.captcha-wrapper)").css(e).find(".js-input:not(.captcha-wrapper), select").css(l),t.find(".input-checkbox-inner .label").css(l),t.find(".input-file-label").css(l),t.find(".input-file-control").css(l),t.find(".js-add-line, .js-remove-line").css({"font-size":r["font-size"]}),t.find(".form-dropdown-triangle").each(function(t,e){var i=(0,o.ZP)(e),n=i.parent(),a=n.find(".js-input"),s=a.position().top,l=n.height()-a.height()-s,h=this.getSvgSizesFromFontSize(r["font-size"],"DROPDOWN_TRIANGLE");i.css({fill:this.getRgba(r["text-color"],r["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER),top:s,bottom:l,width:h.w,height:h.h})}.bind(this)),t.find(".input-checkbox-inner svg").each((function(t,e){var n=(0,o.ZP)(e),a=i.getSvgSizesFromFontSize(r["font-size"],"CHECKBOX_TICK");n.css({fill:i.getRgba(r["text-color"],r["text-opacity"]),width:a.w,height:a.h})}))},applyButtonStyle:function(){var t=this.data,e=t["style-"+t.style+"-fields"],i=t["style-"+t.style+"-button-default"],n=t["style-"+t.style+"-button-hover"],o=this.getButtonValue.bind(this,i,e),a=this.getHoverValue.bind(this,n,i,e),r=o("letter-spacing");this.$button.css({"line-height":this.$button.height()+"px","background-color":this.getRgba(o("color"),o("opacity")),"border-radius":o("border-radius")+"px","box-shadow":"inset 0 0 0 "+o("border-width")+"px "+this.getRgba(o("border-color"),o("border-opacity")),"font-family":o("font-family"),"font-style":o("font-style"),"font-weight":o("font-weight"),color:this.getRgba(o("text-color"),o("text-opacity")),"font-size":o("font-size"),"letter-spacing":r,"text-align":o("text-align"),"text-indent":r/2||0}),this.$buttonIcons.css({fill:this.getRgba(o("text-color"),o("text-opacity"))}),this.$button.attr("data-default",this.$button.attr("style")),this.$button.css({"background-color":this.getRgba(a("color"),a("opacity")),"box-shadow":"inset 0 0 0 "+a("border-width")+"px "+this.getRgba(a("border-color"),a("border-opacity")),color:this.getRgba(a("text-color"),a("text-opacity"))}),this.$button.attr("data-hover",this.$button.attr("style")),this.forcePseudoState||this.$button.attr("style",this.$button.attr("data-default")),this.$button.outerHeight(),this.$button.toggleClass("with-transition",!!n.transition&&"viewer"===this.environment)},getRgba:function(t,e){var i=l.Z.hex2rgb(t);return"rgba("+i[0]+", "+i[1]+","+i[2]+","+e/100+")"},getButtonValue:function(t,e,i){return"inherit"===t[i]?e[i]:t[i]},getHoverValue:function(t,e,i,n){return"inherit"===t[n]?this.getButtonValue(e,i,n):t[n]},onInputHover:function(t){var e=this.data,i=s.Z.clone(e["style-"+e.style+"-fields"]);(0,o.ZP)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]))},onInputHoverOut:function(t){var e=this.data,i=s.Z.clone(e["style-"+e.style+"-fields"]);(0,o.ZP)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER))},onButtonHover:function(){this.$button.hasClass("submitted")||this.$button.attr("style",this.$button.attr("data-hover"))},onButtonHoverOut:function(){this.$button.attr("style",this.$button.attr("data-default"))},destroy:function(){this.$fileInput&&this.$fileInput.off("change",this.onFileChange),this.$el.off(b.Z.isDesktop?"mouseenter":"touchstart",".button",this.onButtonHover).off(b.Z.isDesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut).off("change","select",this.onDropdownChange),this.$el&&this.$el.remove()},getSvgSizesFromFontSize:function(t,e){var i=this[e].H,n=this[e].W,o=this[e].FONT_SIZE;return{h:t*i/o,w:t*n/o}}}),C=_},1340:function(t,e,i){i.r(e);var n=i(311),o=i(320),a=i(1303),r=i(339),s=i(1341);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function h(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw a}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var c=a.Z.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,NUMBER_TEST_REGEX:/^[0-9.,`']+$/,render:function(){var t;(this.makeBox("widget-form"),this.rendered=!0,this.captcha&&!window.recaptchaReadyPromise)&&(window.recaptchaReadyPromise=new Promise((function(e){t=e})),window.onloadRecaptchaCallback=function(){t()},(0,n.ZP)('<script src="https://www.google.com/recaptcha/api.js?onload=onloadRecaptchaCallback&render=explicit" async><\/script>').appendTo("head"));return this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.formWidget=new s.Z({data:this,environment:"viewer",$container:this.$el}),this.formWidget.render(),this.$button=this.$(".button"),this.$button.on("click",this.onButtonClick),this.$(".js-input").on("keydown",this.onInputKeyDown),this.$(".js-input").on("input",this.onInput),this.$("select").on("change",this.onInput),RM.screenshot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this},hasFontsToLoad:function(){return!0},destroy:function(){return this.formWidget&&this.formWidget.destroy(),this.formWidget=null,this.$(".button").off("click",this.onButtonClick),a.Z.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},onButtonClick:function(){this.$button.hasClass("submitted")||(this.setButtonState("pending"),this.formWidget.executeCaptcha(function(){this.sendForm()}.bind(this)))},sendForm:function(){this.validateForm()?("Text after submit"===this.button_caption_after_submit||!this.button_caption_after_submit||this.submit_mode&&"textAfterSubmit"!==this.submit_mode?this.$button.addClass("empty-submitted-text"):this.$button.find(".caption").text(this.button_caption_after_submit),RM.common.isDownloadedSource&&!RM.common.homepageRewrite?this.submitToIframe(function(t){t?(this.setButtonState("error"),RM.analytics&&RM.analytics.sendEvent("Form Submit Error",t)):(this.setButtonState("submitted"),RM.analytics&&RM.analytics.sendEvent("Form Submit Success"))}.bind(this)):this.submitForm(function(t){t?(this.setButtonState("error"),t.responseJSON&&"email_not_confirmed"===t.responseJSON.name&&o.Z.delay((function(){alert(t.responseJSON.message)}),100),RM.analytics&&RM.analytics.sendEvent("Form Submit Error",t)):(this.setButtonState("submitted"),RM.analytics&&RM.analytics.sendEvent("Form Submit Success"))}.bind(this)),this.link_after_submit&&this.submit_mode&&"textAfterSubmit"!==this.submit_mode&&this.applyLink()):this.setButtonState()},applyLink:function(){var t;"toUrlAfterSubmit"===this.submit_mode?this.openInNewTab(this.link_after_submit):(t=this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(this.link_after_submit):"javascript:void(0)",this.mag.router.navigate(t,{trigger:!0}))},openInNewTab:function(t){Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener",href:t}).click()},getDataBySort:function(t){return t=parseInt(t,10),o.Z.findWhere(this.fields,{sort:t})},validateForm:function(){var t=this.$(".js-input"),e=!0;return!(this.captcha&&!this.formWidget.captchaResponse)&&(o.Z.each(t,function(t){var i=(0,n.ZP)(t),o=i.val().trim(),a=this.getDataBySort(i.attr("data-sort")),s=!0;if(o)switch(a.tp){case"name":case"text":case"dropdown":break;case"email":r.Z.isValidEmail(o)||(s=!1);break;case"phone":/^[0123456789 +-]+$/.test(o)||(s=!1);break;case"number":this.NUMBER_TEST_REGEX.test(o)&&!isNaN(parseFloat(o))||(s=!1);break;case"checkbox":a.optional||i.prop("checked")||(s=!1);break;case"captcha":this.formWidget.captchaResponse||(s=!1)}else s=a.optional;s||(this.formWidget.applyInputsStyle(i.closest(".input-wrapper"),{invalid:!0}),e=!1)}.bind(this)),e)},onInput:function(t){var e=(0,n.ZP)(t.currentTarget).parent().find(".js-input");this.formWidget.applyInputsStyle(e.closest(".input-wrapper")),this.setButtonState()},onInputKeyDown:function(t){t.keyCode!==n.ZP.keycodes.enter||(0,n.ZP)(t.target).is("textarea")||(t.preventDefault(),this.onButtonClick()),!(0,n.ZP)(t.target).is("textarea")||t.keyCode!==n.ZP.keycodes.up&&t.keyCode!==n.ZP.keycodes.down||t.stopPropagation()},getFormData:function(){var t={wid:this._id,mag_num_id:this.page.mag.num_id,is_preview:!(!RM.constructorRouter||!RM.constructorRouter.preview),fields:[]};return this.captcha&&(t.captcha=this.formWidget.captchaResponse),o.Z.each(this.fields,function(e){if("captcha"!==e.tp){var i=this.$(".js-input[data-sort="+e.sort+"]");if(0!==i.length){var n=i.val().trim();if("checkbox"===e.tp&&(n=i.prop("checked")?"On":"Off"),"number"===e.tp){var o=parseFloat(n);n=isNaN(o)?n:o}"file"!==e.tp&&t.fields.push({caption:e.caption,type:e.tp,value:n})}}else t.captcha=this.formWidget.captchaResponse}.bind(this)),t},submitForm:function(t){this.xhr&&this.xhr.abort();var e=this.$el.find("form");e.length||(e=this.$el.find(".form-wrapper").wrap('<form enctype="multipart/form-data" method="post" target="form_submit_iframe"></form>').parent().attr("action","/api/connect/forms/send/"+this.page.mag.num_id));var i=new FormData(e.get(0)),o=this.getFormData();if(o&&o.fields){var a,r=h(o.fields);try{for(r.s();!(a=r.n()).done;){var s=a.value;i.delete(s.name)}}catch(t){r.e(t)}finally{r.f()}}for(var u=0,c=Object.keys(o);u<c.length;u++){var p=c[u];i.append(p,"object"===l(o[p])&&null!==o[p]?JSON.stringify(o[p]):o[p])}var d=i.get("formfiles");!d||d.size&&d.name||i.delete("formfiles"),this.xhr=n.ZP.ajax({url:"/api/connect/forms/send/"+this.page.mag.num_id,method:"POST",dataType:"json",data:i,cache:!1,contentType:!1,processData:!1,success:function(){t()},error:function(e){t({status:e.status,responseJSON:e.responseJSON,responseText:e.responseText})}}),RM.analytics&&RM.analytics.sendEvent("Form Submit Click")},submitToIframe:function(t){var e,i=this.endpoint_url&&this.endpoint_url.custom_url;if(!i)return t("No custom URL specified for submit");(0,n.ZP)("#form_submit_iframe").length||(0,n.ZP)('<iframe id="form_submit_iframe" name="form_submit_iframe" style="display:none;"></iframe>').appendTo("body"),(e=this.$el.find("form")).length||(e=this.$el.find(".form-wrapper").wrap('<form method="post" target="form_submit_iframe" enctype="multipart/form-data"></form>')),e.attr("action",i),e.get(0).submit(),t(null),RM.analytics&&RM.analytics.sendEvent("Form Submit Click")},setButtonState:function(t){t=t||"";this.$button.removeClass(["error","submitted","pending"].join(" ")).addClass(t)}});e.default=c}}]);